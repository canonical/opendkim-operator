# Copyright 2025 Canonical Ltd.
# See LICENSE file for licensing details.

type: charm
name: opendkim
title: OpenDKIM charm.
summary: Open source milter for providing DKIM service
links:
  issues: https://github.com/canonical/opendkim-operator/issues
  source: https://github.com/canonical/opendkim-operator
  contact: https://launchpad.net/~canonical-is-devops

description: |
  A [Juju](https://juju.is/) [charm](https://juju.is/docs/olm/charmed-operators)
  deploying and managing [OpenDKIM](http://www.opendkim.org/) on machines.
  
  OpenDKIM is a community effort to develop and maintain a C library for
  producing DKIM-aware applications and an open source milter for providing DKIM service.

base: ubuntu@24.04
platforms:
  amd64:

parts:
  charm:
    plugin: charm
    source: .

provides:
  milter:
    interface: milter

assumes:
  - juju >= 3.6

charm-libs:
- lib: operator_libs_linux.apt
  version: '0'
- lib: operator_libs_linux.systemd
  version: '1'

config:
  options:
    signingtable:
      type: string
      description: |
        Signing table mapping. This configuration is in YAML format. It is a list of
        lines, being each line another list with two elements, the key and the value.
        The file format is refile, so it can include regular expressions.
        The folloging is an example of the signingtable:

            - - "*@example.com"
              - "selector._domainkey.example.com"
            - - "*@other.example.com"
              - "selector._domainkey.other.example.com"
    keytable:
      type: string
      description: |
        Key table mapping. This configuration is in YAML format. It is a list of
        lines, being each line another list with two elements, the key and the value.
        The following is an example of a keytable:

            - - "selector._domainkey.example.com
              - "example.com:selector:/etc/dkimkeys/key1.private"
            - - "selector._domainkey.other.example.com"
              - "other.example.com:selector:/etc/dkimkeys/key2.private"
    private-keys:
      type: secret
      description: |
        Secret that contains the private keys. The keys in the secret define the filename
         without the '.private' extension, and the value the private key.
    mode:
      type: string
      default: 'sv'
      description: |
        Selects operating modes. The string is a concatenation of
        characters that indicate which mode(s) of operation are
        desired. Valid modes are s (signer) and v (verifier). The
        default is sv

        See http://www.opendkim.org/opendkim.conf.5.html
