# Copyright 2025 Canonical Ltd.
# See LICENSE file for licensing details.

type: charm
name: opendkim
title: OpenDKIM charm.
summary: Open source milter for providing DKIM service
links:
  documentation: https://discourse.charmhub.io
  issues: https://github.com/canonical/opendkim-operator/issues
  source: https://github.com/canonical/opendkim-operator
  contact: https://launchpad.net/~canonical-is-devops

description: |
  A [Juju](https://juju.is/) [charm](https://juju.is/docs/olm/charmed-operators)
  deploying and managing [OpenDKIM](http://www.opendkim.org/) on machines.
  
  OpenDKIM is a community effort to develop and maintain a C library for
  producing DKIM-aware applications and an open source milter for providing DKIM service.

base: ubuntu@24.04
platforms:
  amd64:

parts:
  charm:
    plugin: charm
    source: .

config:
  options:
    domains:
      type: string
      default: '- "*"'
      description: |
        YAML list of sender domain(s) to sign
        messages for (default '*' will sign messages for all domains).
    keytable:
      type: string
      default: ''
      description: |
        Key table mapping.
    mode:
      type: string
      default: 'sv'
      description: |
        Selects operating modes. The string is a concatenation of
        characters that indicate which mode(s) of operation are
        desired. Valid modes are s (signer) and v (verifier). The
        default is sv
  
        See http://www.opendkim.org/opendkim.conf.5.html
    selector:
      type: string
      default: 'mail'
      description: |
        Selector to use when signing messages with DKIM.
    signingtable:
      type: string
      default: ''
      description: |
        Signing table mapping.
    private-keys:
      type: secret
      description: |
        Dictionary with key names and the private keys.

provides:
  milter:
    interface: milter

assumes:
  - juju >= 3.3

charm-libs:
- lib: operator_libs_linux.apt
  version: '0'
