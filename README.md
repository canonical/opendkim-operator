<!--
Avoid using this README file for information that is maintained or published elsewhere, e.g.:

* metadata.yaml > published on Charmhub
* documentation > published on (or linked to from) Charmhub
* detailed contribution guide > documentation or CONTRIBUTING.md

Use links instead.
-->
<!--
NOTE: This template has the documentation under the `docs-template` due with issues with discourse-gatekeeper. The `docs-template` directory must be changed to `docs` after using this template to ensure discourse-gatekeeper correctly identifies the documentation changes.
-->
# OpenDKIM charm
<!-- Use this space for badges -->

A [Juju](https://juju.is/) [charm](https://documentation.ubuntu.com/juju/3.6/reference/charm/) deploying and
managing [OpenDKIM](http://www.opendkim.org/) on machines.

Like any Juju charm, this charm supports one-line deployment, configuration, integration, scaling, and more.

The OpenDKIM charm installs and configures the [OpenDKIM](http://www.opendkim.org/) application and offers
other charms the ability to sign and validate email messages using the `milter` relation.

For information about how to deploy, integrate, and manage this charm, see the Official [OpenDKIM Documentation](https://charmhub.io/opendkim/docs).

## Get started

The OpenDKIM charm offers signing and validation DKIM services through the `milter`
relation. To configure it you need to set the `signingtable` , `keytable` and `private-keys` and 
configuration options ([see OpenDKIM Configurations](https://charmhub.io/opendkim/configurations)
for more information).

Provision a Juju environment then deploy the OpenDKIM charm with:

```
juju deploy opendkim
```

Then integrate to an already deployed postfix-relay Juju application:

```
juju integrate opendkim postfix-relay
```

Configure the OpenDKIM charm using the keys generated by the `opendkim-genkey` command line tool. 
We will use `selector` as the selector name and `example.com` as the domain name.
```
opendkim-genkey -s selector -d example.com
```

The `opendkim-genkey` command will generate two files, `selector.private` for the private key and 
`selector.txt` for the DNS record.

Add the private key as a secret to the charm:
```
juju config opendkim
juju add-secret private-keys-for-opendkim keyfilename#file=selector.private
SECRET_ID=$(juju grant-secret private-keys-for-opendkim opendkim)
juju config opendkim private-keys=${SECRET_ID}
```

Configure the `signingtable` and `keytable` configuration options to match the file for the
private key and the desired configuration:

```
juju config opendkim signingtable='[["selector._domainkey.example.com", "example.com:selector:/etc/dkimkeys/keyfilename.private"]]'
juju config opendkim keytable='[["*@example.com", "selector._domainkey.example.com"]]'
```

For more information, see the
[OpenDKIM Configuration format](https://charmhub.io/opendkim/docs) and the
[opendkim.conf manual](http://www.opendkim.org/opendkim.conf.5.html).

## Learn more
<!-- 
Provide a list of resources, including the official documentation, developer documentation,
an official website for the software and a troubleshooting guide. Note that this list is not
exhaustive or always relevant for every charm. If there is no official troubleshooting guide,
include a link to the relevant Matrix channel.
-->

* [Read more](https://charmhub.io/opendkim) <!--Link to the charm's official documentation-->
* [Developer documentation](http://www.opendkim.org/docs.html) <!--Link to any developer documentation (could be upstream)-->
* [Official webpage](http://www.opendkim.org/) <!--(Optional) Link to official upstream webpage/blog/marketing content-->
* [Troubleshooting](https://matrix.to/#/#charmhub-charmdev:ubuntu.com) 

## Project and community
* [Issues](https://github.com/canonical/opendkim-operator/issues)
* [Contributing](https://github.com/canonical/opendkim-operator/blob/main/CONTRIBUTING.md)
* [Matrix](https://matrix.to/#/#charmhub-charmdev:ubuntu.com)

